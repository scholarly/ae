---
title: "Wikipedia Vandalism"
author: "Terrel Shumway"
date: "04/11/2015"
output: html_document
---

First, we download and read the file `wiki.csv`...

```{r,echo=FALSE}

remote = "https://courses.edx.org/c4x/MITx/15.071x_2/asset/wiki.csv"
local = "wiki.csv"
if(!file.exists(local)){
  download.file(remote,local,"curl")
}
wiki = read.csv(local,stringsAsFactors=F)
str(wiki)
```

## Problem 1.1
Problem 1.1: There are `r sum(wiki$Vandal)` vandalism cases in the dataset.


## Problem 1.2: Bag of Words

```{r}
library(tm)
library(SnowballC)
corpus = Corpus(VectorSource(wiki$Added))
corpus = tm_map(corpus,PlainTextDocument)
corpus = tm_map(corpus,removeWords, stopwords("english"))
corpus = tm_map(corpus,stemDocument)

dtm = DocumentTermMatrix(corpus)

```

Problem 1.2: There are `r ncol(dtm)` terms in the document term matrix

```{r}
sparse = removeSparseTerms(dtm,0.997)
```

Problem 1.3: There are `r ncol(sparse)` terms in the pruned matrix

```{r}
wordsAdded = as.data.frame(as.matrix(sparse))
colnames(wordsAdded) = paste("A",colnames(wordsAdded))
```

## Words removed

```{r}
corpus = Corpus(VectorSource(wiki$Removed))
corpus = tm_map(corpus,PlainTextDocument)
corpus = tm_map(corpus,removeWords, stopwords("english"))
corpus = tm_map(corpus,stemDocument)

dtm = DocumentTermMatrix(corpus)

sparse = removeSparseTerms(dtm,0.997)

wordsRemoved = as.data.frame(as.matrix(sparse))
colnames(wordsRemoved) = paste("R",colnames(wordsRemoved))

```

Problem 1.4: There are `r ncol(sparse)` terms in the pruned matrix

## Combine the bags

```{r}
wikiWords = cbind(wordsAdded,wordsRemoved)
wikiWords$Vandal = wiki$Vandal
```

## Split into train and test sets

```{r}
library(caTools)
set.seed(123)
split = sample.split(wikiWords$Vandal,SplitRatio=0.7)
train = subset(wikiWords,split)
test = subset(wikiWords,!split)
```

```{r}
N = nrow(test)
bl.c = table(test$Vandal)
bl.acc = bl.c[1]/N
```

Problem 1.5: The baseline model has accuracy `r bl.acc`.

## Build a CART model

```{r}

library(rpart)
library(rpart.plot)
m1 = rpart(Vandal~.,data=train,method="class")

m1.p = predict(m1,newdata=test,type="class")
m1.c = table(test$Vandal,m1.p)
m1.acc = (m1.c[1,1]+m1.c[2,2])/nrow(test)

```

Problem 1.6: The default CART model has accuracy `r m1.acc`.

```{r,echo=F}
prp(m1)
m1.splits = m1$cptable[nrow(m1$cptable),'nsplit']
```
Problem 1.7: `r m1.splits` terms

